<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regen_Notes - Imputation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Regen_Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./1_Copied_Code.html" rel="" target="">
 <span class="menu-text">Plot Selection</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./2_Imputation.html" rel="" target="" aria-current="page">
 <span class="menu-text">Imputation</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#set-1-3-vs-6-full-set-vs-regen-only" id="toc-set-1-3-vs-6-full-set-vs-regen-only" class="nav-link" data-scroll-target="#set-1-3-vs-6-full-set-vs-regen-only">Set 1, 3 vs 6, full set vs regen only</a>
  <ul class="collapse">
  <li><a href="#plots-3-vs-6-full-vs-regen" id="toc-plots-3-vs-6-full-vs-regen" class="nav-link" data-scroll-target="#plots-3-vs-6-full-vs-regen">Plots, 3 vs 6 &amp; Full vs Regen</a></li>
  </ul></li>
  <li><a href="#fpag-to-fpa" id="toc-fpag-to-fpa" class="nav-link" data-scroll-target="#fpag-to-fpa">FPAG to fpa</a></li>
  <li><a href="#species-prevalence" id="toc-species-prevalence" class="nav-link" data-scroll-target="#species-prevalence">Species prevalence</a></li>
  <li><a href="#set-2-rf-on-cds" id="toc-set-2-rf-on-cds" class="nav-link" data-scroll-target="#set-2-rf-on-cds">Set 2, RF on CDS</a>
  <ul class="collapse">
  <li><a href="#plots-rf-full-set" id="toc-plots-rf-full-set" class="nav-link" data-scroll-target="#plots-rf-full-set">Plots, RF, Full set</a></li>
  </ul></li>
  <li><a href="#rf-on-seedlings-only." id="toc-rf-on-seedlings-only." class="nav-link" data-scroll-target="#rf-on-seedlings-only.">RF on seedlings only.</a>
  <ul class="collapse">
  <li><a href="#sp-prev" id="toc-sp-prev" class="nav-link" data-scroll-target="#sp-prev">Sp prev</a></li>
  <li><a href="#cds" id="toc-cds" class="nav-link" data-scroll-target="#cds">CDS</a></li>
  <li><a href="#plots" id="toc-plots" class="nav-link" data-scroll-target="#plots">Plots</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Imputation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<ol type="1">
<li>First set</li>
</ol>
<p>First set is a repeat of the first imputation I did. This one is using the full set of CNs. That is, it contains all the stands that are in ecoregions associated with the study area.</p>
<p>It is comparing the Kralicek three predictors vs the set that contains elevation, aspect, and slope as well. The z variables indicate that the data set only contains plots that have seedlings. There are less zeroes in that set. The full set is about half zeroes.</p>
<p>This set has the msn and mal distance plots, but not RF.</p>
<ol start="2" type="1">
<li>Set 2</li>
</ol>
<p>Adding in Random Forests, broadening FPAG to fpa by removing one digit from the Ecoregion code. Organizing the response by species prevalence. Prevalent species are those that have records starting between the 75 percentile and the 90th. It is all zeroes before that. Common species start between the 90th and 97.5. Uncommon species start to have records between 97.5 and 99. Rare after 99.</p>
<p>Prevalent species are</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">SYMBL</th>
<th style="text-align: center;">Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">PSME</td>
<td style="text-align: center;">Doug-fir</td>
</tr>
<tr class="even">
<td style="text-align: center;">ABAM</td>
<td style="text-align: center;">silver fir</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ABLA</td>
<td style="text-align: center;">subalpine fir</td>
</tr>
<tr class="even">
<td style="text-align: center;">TSHE</td>
<td style="text-align: center;">western hemlock</td>
</tr>
</tbody>
</table>
<p>Common species are:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">SYMBL</th>
<th style="text-align: center;">Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">PIPO</td>
<td style="text-align: center;">Ponderosa pine</td>
</tr>
<tr class="even">
<td style="text-align: center;">TSME</td>
<td style="text-align: center;">Mountain Hemlock</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ABGR</td>
<td style="text-align: center;">Grand Fir</td>
</tr>
<tr class="even">
<td style="text-align: center;">THPL</td>
<td style="text-align: center;">Red Cedar</td>
</tr>
<tr class="odd">
<td style="text-align: center;">PIEN</td>
<td style="text-align: center;">Engelmann spruce</td>
</tr>
<tr class="even">
<td style="text-align: center;">PICO</td>
<td style="text-align: center;">Lodgepole pine</td>
</tr>
<tr class="odd">
<td style="text-align: center;">PIMO3</td>
<td style="text-align: center;">W. White Pine</td>
</tr>
</tbody>
</table>
<p>Uncommon species are:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">SYMBL</th>
<th style="text-align: center;">Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">PIAL</td>
<td style="text-align: center;">whitebark pine</td>
</tr>
<tr class="even">
<td style="text-align: center;">ACGL</td>
<td style="text-align: center;">Rocky Mountain maple</td>
</tr>
<tr class="odd">
<td style="text-align: center;">LAOC</td>
<td style="text-align: center;">western larch</td>
</tr>
<tr class="even">
<td style="text-align: center;">TABR2</td>
<td style="text-align: center;">Pacific yew</td>
</tr>
<tr class="odd">
<td style="text-align: center;">CHNO</td>
<td style="text-align: center;">Alaska yellow-cedar</td>
</tr>
<tr class="even">
<td style="text-align: center;">POTR5</td>
<td style="text-align: center;">quaking aspen</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">quietly =</span> T)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(esquisse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(yaImpute)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RSQLite)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RSQLite)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-1-3-vs-6-full-set-vs-regen-only" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="set-1-3-vs-6-full-set-vs-regen-only">Set 1, 3 vs 6, full set vs regen only</h2>
<p>This is a repeat of the first comparison I did. I am using the expanded dataset for this run, but for CDS6, it is only about 400 extra plots.</p>
<p>This time around, I saved a dataset where I only kept plots/stands that had regeneration/seedlings. So I changed it a little to compare three and six predictor variable models while also seeing what happens without so many zeroes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pulling from my new interim save point</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"./attempt_032524.db"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>imp_data <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from imp_data"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>zimp_data <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from regen_only_imp_data"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from fvs_plotinit_plot"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>plants_ref <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from plants_ref"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(con)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>pred_topo <span class="ot">&lt;-</span> plots <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  STANDPLOT_CN, ELEVFT, SLOPE, ASPECT</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>pred_Kral <span class="ot">&lt;-</span> imp_data <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  STANDPLOT_CN, CC, BA, SDI, FPAG</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> imp_data <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">c</span>(CC, BA, SDI, FPAG)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">left_join</span>(pred_Kral, pred_topo)<span class="sc">|&gt;</span> </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(FPAG, <span class="at">.after =</span> STANDPLOT_CN)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering for only CDS6</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>cds6 <span class="ot">&lt;-</span> predictors <span class="sc">|&gt;</span> <span class="fu">filter</span>(</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  FPAG <span class="sc">==</span> <span class="st">"CDS6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(FPAG))</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>cds_cns <span class="ot">&lt;-</span> cds6 <span class="sc">|&gt;</span> <span class="fu">select</span>(STANDPLOT_CN)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>zcds_cns <span class="ot">&lt;-</span> zimp_data <span class="sc">|&gt;</span> <span class="fu">filter</span>(FPAG <span class="sc">==</span> <span class="st">"CDS6"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(STANDPLOT_CN)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>zcds6 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(zcds_cns, cds6, <span class="at">by =</span><span class="st">"STANDPLOT_CN"</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Joining the x and y</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>imp_2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cds_cns, response, <span class="at">by =</span> <span class="st">"STANDPLOT_CN"</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Making CN into rownames</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>imp_2 <span class="ot">&lt;-</span> <span class="fu">column_to_rownames</span>(imp_2, <span class="st">"STANDPLOT_CN"</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co"># making sure it's not all zero</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>imp_2 <span class="ot">&lt;-</span> imp_2[, <span class="sc">!</span><span class="fu">colSums</span>(imp_2) <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>imp_2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cds6, response)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>zimp_2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(zcds6, response)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co"># form some test data, y's are defined only for reference observations.</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co"># refs  =  sample(x  =  rownames(imp_2), size  =  (nrow(imp_2)/4)*3)</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>refs <span class="ot">&lt;-</span> <span class="fu">rownames</span>(imp_2[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">round</span>(.<span class="dv">75</span><span class="sc">*</span><span class="fu">nrow</span>(imp_2))), ])</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co"># zrefs  =  sample(x  =  rownames(zimp_2), size  =  (nrow(zimp_2)/4)*3)</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>zrefs <span class="ot">&lt;-</span> <span class="fu">rownames</span>(zimp_2[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">round</span>(.<span class="dv">75</span><span class="sc">*</span><span class="fu">nrow</span>(zimp_2))), ])</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co"># x is every row and column of predictor variables.</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co"># CC, BA, SDI, ELEVFT, SLOPE, ASPECT</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>X_predictors1 <span class="ot">&lt;-</span> imp_2 <span class="sc">|&gt;</span> <span class="fu">select</span>(CC, BA, SDI)</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>X_predictors2 <span class="ot">&lt;-</span> imp_2 <span class="sc">|&gt;</span> <span class="fu">select</span>(CC, BA, SDI, ELEVFT, SLOPE, ASPECT)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>zX_predictors1 <span class="ot">&lt;-</span> zimp_2 <span class="sc">|&gt;</span> <span class="fu">select</span>(CC, BA, SDI)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>zX_predictors2 <span class="ot">&lt;-</span> zimp_2 <span class="sc">|&gt;</span> <span class="fu">select</span>(CC, BA, SDI, ELEVFT, SLOPE, ASPECT)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="co"># y is all other columns, seedling tree densities. </span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="co"># row names are row numbers</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co"># y &lt;- imp_df[refs,3:36], this was the example code. </span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>Y_response <span class="ot">&lt;-</span> imp_2[refs,] <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"TD"</span>)) </span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>Y_response <span class="ot">&lt;-</span> Y_response[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>Y_response))]</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>zY_response <span class="ot">&lt;-</span> zimp_2[zrefs,] <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"TD"</span>)) </span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>zY_response <span class="ot">&lt;-</span> zY_response[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>zY_response))]</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="co"># remove zero columns</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>Y_response <span class="ot">&lt;-</span> Y_response[, <span class="sc">!</span><span class="fu">colSums</span>(Y_response) <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>zY_response <span class="ot">&lt;-</span> zY_response[, <span class="sc">!</span><span class="fu">colSums</span>(zY_response) <span class="sc">==</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># build yai objects using</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># most similar neighbor</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>msn_dist_3 <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> X_predictors1, <span class="at">y =</span> Y_response, <span class="at">method =</span> <span class="st">"msn"</span>, <span class="at">k =</span> k)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># and mahalanobis</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>mal_dist_3 <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> X_predictors1, <span class="at">y =</span> Y_response, <span class="at">method =</span> <span class="st">"mahalanobis"</span>, <span class="at">k =</span> k)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># For the expanded list of predictors</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>msn_dist_6 <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> X_predictors2, <span class="at">y =</span> Y_response, <span class="at">method =</span> <span class="st">"msn"</span>, <span class="at">k =</span> k)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># and mahalanobis</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>mal_dist_6 <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> X_predictors2, <span class="at">y =</span> Y_response, <span class="at">method =</span> <span class="st">"mahalanobis"</span>, <span class="at">k =</span> k)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Small predictors but standarcized</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>zmsn_dist_3 <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> zX_predictors1, <span class="at">y =</span> zY_response, <span class="at">method =</span> <span class="st">"msn"</span>, <span class="at">k =</span> k)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># and mahalanobis</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>zmal_dist_3 <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> zX_predictors1, <span class="at">y =</span> zY_response, <span class="at">method =</span> <span class="st">"mahalanobis"</span>, <span class="at">k =</span> k)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardized expanded</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>zmsn_dist_6 <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> zX_predictors2, <span class="at">y =</span> zY_response, <span class="at">method =</span> <span class="st">"msn"</span>, <span class="at">k =</span> k)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># and mahalanobis</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>zmal_dist_6 <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> zX_predictors2, <span class="at">y =</span> zY_response, <span class="at">method =</span> <span class="st">"mahalanobis"</span>, <span class="at">k =</span> k)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>imputed_msn_dist_3 <span class="ot">&lt;-</span> <span class="fu">impute</span>(msn_dist_3)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># imputed_mal_dist_1 &lt;- impute(mal_dist_1)</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>imputed_msn_dist_6 <span class="ot">&lt;-</span> <span class="fu">impute</span>(msn_dist_6)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># imputed_mal_dist_2 &lt;- impute(mal_dist_2)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>imputed_zmsn_dist_3 <span class="ot">&lt;-</span> <span class="fu">impute</span>(zmsn_dist_3)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># imputed_zmal_dist_1 &lt;- impute(zmal_dist_1)</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>imputed_zmsn_dist_6 <span class="ot">&lt;-</span> <span class="fu">impute</span>(zmsn_dist_6)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># imputed_zmal_dist_2 &lt;- impute(zmal_dist_2)</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'PSME_TD'</span>, <span class="st">'PICO_TD'</span>, <span class="st">'PIPO_TD'</span>, <span class="st">'PRVI_TD'</span>, <span class="st">'ABGR_TD'</span>, <span class="st">'PREM_TD'</span>, </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>           <span class="st">'PSME_TD.o'</span>, <span class="st">'PICO_TD.o'</span>, <span class="st">'PIPO_TD.o'</span>, <span class="st">'PRVI_TD.o'</span>, <span class="st">'ABGR_TD.o'</span>, <span class="st">'PREM_TD.o'</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>imp_msn_dist_3 <span class="ot">&lt;-</span> imputed_msn_dist_3[, <span class="fu">names</span>(imputed_msn_dist_3) <span class="sc">%in%</span> names] <span class="sc">|&gt;</span> </span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PSME_TD <span class="sc">&lt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> PSME_TD.o <span class="sc">&lt;</span> <span class="dv">15000</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>imp_msn_dist_6 <span class="ot">&lt;-</span> imputed_msn_dist_6[, <span class="fu">names</span>(imputed_msn_dist_6) <span class="sc">%in%</span> names] <span class="sc">|&gt;</span> </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PSME_TD <span class="sc">&lt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> PSME_TD.o <span class="sc">&lt;</span> <span class="dv">15000</span>)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>zimp_msn_dist_3 <span class="ot">&lt;-</span> imputed_zmsn_dist_3[, <span class="fu">names</span>(imputed_zmsn_dist_3) <span class="sc">%in%</span> names] <span class="sc">|&gt;</span> </span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PSME_TD <span class="sc">&lt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> PSME_TD.o <span class="sc">&lt;</span> <span class="dv">15000</span>)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>zimp_msn_dist_6 <span class="ot">&lt;-</span> imputed_zmsn_dist_6[, <span class="fu">names</span>(imputed_zmsn_dist_6) <span class="sc">%in%</span> names] <span class="sc">|&gt;</span> </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PSME_TD <span class="sc">&lt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> PSME_TD.o <span class="sc">&lt;</span> <span class="dv">15000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="plots-3-vs-6-full-vs-regen" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="plots-3-vs-6-full-vs-regen">Plots, 3 vs 6 &amp; Full vs Regen</h3>
<p>Here are imputed vs observed when using other the Kralicek 3 variables or adding elev, slope, and aspect for the 6 variable ones.</p>
<div class="page-columns page-full">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imp_msn_dist_3)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imp_msn_dist_6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell column-page quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<hr>
<p>Here are the three vs six variable plots, but this time, z is for zero. As in there are no zeroes in response variables. z means these are only for plots that have seedlings.</p>
<div class="page-columns page-full">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zimp_msn_dist_3)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zimp_msn_dist_6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell column-page quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<hr>
<p>Three variables, all plots vs seedling only plots/stands.</p>
<p><strong>These have different labels. Prvi and Abgr are swapped.</strong></p>
<div class="page-columns page-full">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imp_msn_dist_3)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zimp_msn_dist_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell column-page quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<hr>
<p>Six variable plots, all stands vs seeldings only.</p>
<div class="page-columns page-full">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imp_msn_dist_6)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zimp_msn_dist_6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell column-page quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="fpag-to-fpa" class="level2">
<h2 class="anchored" data-anchor-id="fpag-to-fpa">FPAG to fpa</h2>
<p>I am skipping a set of imputations I did before, in attempt 4 fpag. That one was a failure because FPAG couldn’t be added to the distance matrix. I couldn’t use it with MSN, I don’t think I have tried to use it with RF yet.</p>
<p>This set of code is from CH 14 in the regen book.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pulling from my new interim save point</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"./attempt_032524.db"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>imp_data <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from imp_data"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>zimp_data <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from regen_only_imp_data"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from fvs_plotinit_plot"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>plants_ref <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from plants_ref"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(con)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>imp_data_orig <span class="ot">&lt;-</span> imp_data</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Grabbing the topography variables</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>pred_topo <span class="ot">&lt;-</span> plots <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  STANDPLOT_CN, ELEVFT, SLOPE, ASPECT</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the Kralicek variables</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>pred_Kral <span class="ot">&lt;-</span> imp_data <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  STANDPLOT_CN, CC, BA, SDI, FPAG</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the predictors from the response.</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> imp_data <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">c</span>(CC, BA, SDI, FPAG)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># join the Kralicek and topo variables. </span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">left_join</span>(pred_Kral, pred_topo, <span class="fu">join_by</span>(STANDPLOT_CN))<span class="sc">|&gt;</span> </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(FPAG, <span class="at">.after =</span> STANDPLOT_CN)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(imp_data<span class="sc">$</span>FPAG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "CWF4" "CDS6" "CDS2" "CAS3" "CDG1" "CMS3" "CWS5" "CHS1" "CES4" "CES2"
 [11] "CES1" "CAC1" "CPS2" "CDS7" "CPG1" "CEF2" "CPS5" "CES3" "CDS8" "CD"  
 [21] "CWG1" "CWS2" "CWF2" "CP"   "CF"   "CFF2" "CEG3" "CMS2" "CHF2" "CW"  
 [31] "HC"   "CC"   "CEF4" "CAG1" "CDG3" "CDS4" "CES"  "CFS5" "CEM2" "CHS4"
 [41] "CCS2" "CCF2" "CHF3" "CH"   "CWS4" "CFS6" "CFS2" "CFS4" "HO"   "CE"  
 [51] "CLS5" "CWS3" "CWS8" "CCS3" "HQS2" "CHS2" "CFS3" "CEF1" "CHF1" "CPG2"
 [61] "CMS1" "CFF1" "HOG2" "CWF3" "HOG1" "CMF1" "CMG2" "CEG1" "CDS"  "CE41"
 [71] "CW61" "CCHS" "CDS1" "CEFH" "CD81" "CEFA" "CW55" "CAG2" "CAS4" "CHF4"
 [81] "CDG2" "HQG1" "CHS7" "CAS2" "HQM2" "CDF4" "HX"   "CHS6" "CMS5" "CHC2"
 [91] "HQ"   "HOG3" "CD27" "HOS6" "HOS3" "CWC4" "CPS3" "HAM1" "CEM3" "CA"  
[101] "CWGI" "SW72" "CL"   "CD63" "CDH4" "CPS0" "CPG0" "CD61" "CWF5" "CEG2"
[111] "CDF0" "CPF0" "CERR" "CWF0" "CEFM" "HOC2" "CHF5" "CACE" "CS"   "CM"  
[121] "CEN2" "CDGE" "cds7" "HCS3" "HQS0" "HCS1" "CM53" "CDG6" "CS53" "CEM1"
[131] "CE54" "CDS5" "CES5" "HAS3" "CEF3" "CAGO" "CAC5" "SW21" "CAF3" "HOS1"
[141] "HA"   "CDS3" "CW33" "CLM4" "CFF4" "CFS1" "CHS5" "HB"   "CH21" "CHS3"
[151] "CMS4" "chs5" "CSF1" "CAG3" "CHM1" "CLS3" "HBS1" "CFF3" "CAF2" "CMF2"
[161] "SM20" "CFS"  "CHFS" "CH62" "CFM1" "CHMI" "HBM1" "CFRR" "CHD1" "CHS8"
[171] "CHF9" "CHFI" "CHSI" "HAM0" "CLS4" "SM81" "CLS2" "CES6" "CSF2" "CFSC"
[181] "CHF"  "CHS9" "CH6-" "CSF3" "HM"   "HD"   "CFS-" "SM40" "CHF6" "CHS" 
[191] "CAS-" "CDRX" "HAS1" "CH12" "CHF0" "HCD1" "CM55" "HAF" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>imp_data <span class="sc">|&gt;</span> <span class="fu">group_by</span>(FPAG) <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  FPAG      n
  &lt;chr&gt; &lt;int&gt;
1 CDS6   2396
2 CFS2   2004
3 CHS1   1524
4 CHF1   1462
5 CDS7   1352
6 CDG1   1090</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>imp_data_FPA <span class="ot">&lt;-</span> imp_data <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fpa =</span> <span class="fu">str_sub</span>(FPAG, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">unique</span>(imp_data_FPA<span class="sc">$</span>fpa)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "CWF" "CDS" "CAS" "CDG" "CMS" "CWS" "CHS" "CES" "CAC" "CPS" "CPG" "CEF"
[13] "CD"  "CWG" "CP"  "CF"  "CFF" "CEG" "CHF" "CW"  "HC"  "CC"  "CAG" "CFS"
[25] "CEM" "CCS" "CCF" "CH"  "HO"  "CE"  "CLS" "HQS" "HOG" "CMF" "CMG" "CE4"
[37] "CW6" "CCH" "CD8" "CW5" "HQG" "HQM" "CDF" "HX"  "CHC" "HQ"  "CD2" "HOS"
[49] "CWC" "HAM" "CA"  "SW7" "CL"  "CD6" "CDH" "CPF" "CER" "HOC" "CS"  "CM" 
[61] "CEN" "cds" "HCS" "CM5" "CS5" "CE5" "HAS" "SW2" "CAF" "HA"  "CW3" "CLM"
[73] "HB"  "CH2" "chs" "CSF" "CHM" "HBS" "SM2" "CH6" "CFM" "HBM" "CFR" "CHD"
[85] "SM8" "HM"  "HD"  "SM4" "CDR" "CH1" "HCD" "HAF"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 17 fpas vs 34 FPAGs</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(imp_data_FPA<span class="sc">$</span>fpa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 92</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(imp_data_FPA<span class="sc">$</span>FPAG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 198</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># n_distinct(imp_data$FPAG)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 4028 vs 2402 in the largest group</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>imp_data_FPA <span class="sc">|&gt;</span> <span class="fu">group_by</span>(fpa) <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  fpa       n
  &lt;chr&gt; &lt;int&gt;
1 CDS    4615
2 CFS    2945
3 CHS    2520
4 CHF    2430
5 CES    2055
6 CMS    1532</code></pre>
</div>
</div>
<p>Before expanding the set, there were 17 fpas and 34 fpags. Now there are 92 fpas and 198 FPAGs</p>
<p>Here is the table before:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">fpa</th>
<th style="text-align: center;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">CDS</td>
<td style="text-align: center;">4028</td>
</tr>
<tr class="even">
<td style="text-align: center;">CES</td>
<td style="text-align: center;">2004</td>
</tr>
<tr class="odd">
<td style="text-align: center;">CFS</td>
<td style="text-align: center;">1840</td>
</tr>
<tr class="even">
<td style="text-align: center;">CDG</td>
<td style="text-align: center;">1383</td>
</tr>
<tr class="odd">
<td style="text-align: center;">CMS</td>
<td style="text-align: center;">1221</td>
</tr>
<tr class="even">
<td style="text-align: center;">CHS</td>
<td style="text-align: center;">1220</td>
</tr>
</tbody>
</table>
</section>
<section id="species-prevalence" class="level2">
<h2 class="anchored" data-anchor-id="species-prevalence">Species prevalence</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">apply</span>(imp_data, <span class="dv">2</span>, max) </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> z[<span class="dv">6</span><span class="sc">:</span><span class="fu">length</span>(z)]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">names</span>(z)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> z</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(y) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(y)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(y) <span class="ot">&lt;-</span> x</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a sorted list of the maximum trees per acre per species on one plot</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>y <span class="sc">|&gt;</span> <span class="fu">sort</span>(<span class="at">decreasing =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    TSHE_TD     PIEN_TD     ACGL_TD     PICO_TD     PSME_TD     THPL_TD 
47527.98907 24588.61264 24063.85567 18816.28590 15142.98705 14768.16064 
    ABGR_TD     ABAM_TD     BEPA_TD     LAOC_TD     PIPO_TD     FRLA_TD 
13793.61197 12219.34104 10944.93124 10345.20898  9070.79918  8770.93805 
    ABLA_TD     MAFU_TD     TSME_TD     PRVI_TD     PREM_TD     CHNO_TD 
 7796.38937  7196.66712  4722.81279  4347.98638  3523.36827  3148.54186 
   POTR5_TD     ABPR_TD     LALY_TD    TABR2_TD    ALRU2_TD     PRAV_TD 
 2773.71545  2623.78489  2548.81960  2248.95847  2248.95847  2248.95847 
   QUGA4_TD    PIMO3_TD    POBAT_TD     ABCO_TD    ACMA3_TD     PIAL_TD 
 2099.02791  1874.13206  1274.40980  1274.40980  1049.51395   974.54867 
    PISI_TD    CONU4_TD      2TB_TD    ALRH2_TD     JUOC_TD     CHLA_TD 
  674.68754   449.79170   449.79170   449.79170   374.82641   374.82640 
    ARME_TD    PRPE2_TD     JUNI_TD    BEOC2_TD     PSMA_TD     BEUT_TD 
  224.89585   224.89585   149.93060   149.93057    74.96528    74.96528 
    JUHI_TD 
   74.96528 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> imp_data</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>imp_p <span class="ot">&lt;-</span> imp <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>imp_r <span class="ot">&lt;-</span> imp <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">6</span><span class="sc">:</span><span class="fu">ncol</span>(imp))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>imp_r <span class="ot">&lt;-</span> imp_r <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_TD =</span> <span class="fu">rowSums</span>(imp_r[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(imp_r)])</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">left_join</span>(imp_p, imp_r, <span class="at">by =</span> <span class="st">"STANDPLOT_CN"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>imp_z <span class="ot">&lt;-</span> imp[imp<span class="sc">$</span>total_TD <span class="sc">&gt;</span> <span class="dv">0</span>,]</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(imp_z[,6:ncol(imp_z)])</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(imp_z[,6:ncol(imp_z)], 2, quantile, seq(0.72, 0.90, .04))</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>prevalent_sp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'PSME_TD'</span>, <span class="st">'ABAM_TD'</span>, <span class="st">'ABLA_TD'</span>, <span class="st">'TSHE_TD'</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">names</span>(imp_z)[<span class="sc">!</span><span class="fu">names</span>(imp_z) <span class="sc">%in%</span> prevalent_sp]</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>imp_z2 <span class="ot">&lt;-</span> imp_z[,keep]</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(imp_z2[,6:ncol(imp_z2)], 2, quantile, seq(0.90, 0.9875, .025))</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>common_sp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'PIPO_TD'</span> , <span class="st">'TSME_TD'</span>, <span class="st">'ABGR_TD'</span>, <span class="st">'THPL_TD'</span>, <span class="st">'PIEN_TD'</span>, <span class="st">'PICO_TD'</span>, <span class="st">'PIMO3_TD'</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">names</span>(imp_z2)[<span class="sc">!</span><span class="fu">names</span>(imp_z2) <span class="sc">%in%</span> common_sp]</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>imp_z3 <span class="ot">&lt;-</span> imp_z2[,keep]</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(imp_z3[,6:ncol(imp_z3)], 2, quantile, seq(0.975, .99, .005))</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>uncommon_sp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'PIAL_TD'</span>, <span class="st">'ACGL_TD'</span>, <span class="st">'LAOC_TD'</span>, <span class="st">'TABR2_TD'</span>, <span class="st">'CHNO_TD'</span>, </span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'POTR5_TD'</span>)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">names</span>(imp_z3)[<span class="sc">!</span><span class="fu">names</span>(imp_z3) <span class="sc">%in%</span> uncommon_sp]</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>imp_z4 <span class="ot">&lt;-</span> imp_z3[,keep]</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(imp_z4[,6:ncol(imp_z4)], 2, quantile, seq(0.99, 1, .005))</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>rare_sp <span class="ot">&lt;-</span> <span class="fu">names</span>(imp_z4[,<span class="dv">6</span><span class="sc">:</span>(<span class="fu">ncol</span>(imp_z4)<span class="sc">-</span><span class="dv">1</span>)])</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>sp_prevalence <span class="ot">&lt;-</span>  <span class="fu">list</span>(<span class="at">prevalent =</span> prevalent_sp, </span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>     <span class="at">common =</span> common_sp, </span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>     <span class="at">uncommon =</span> uncommon_sp, </span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>     <span class="at">rare =</span> rare_sp)</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a><span class="co"># save(sp_prevalence, file = "sp_prevalence.Rdata")</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a><span class="co"># getwd()</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sp_prevalence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$prevalent
[1] "PSME_TD" "ABAM_TD" "ABLA_TD" "TSHE_TD"

$common
[1] "PIPO_TD"  "TSME_TD"  "ABGR_TD"  "THPL_TD"  "PIEN_TD"  "PICO_TD"  "PIMO3_TD"

$uncommon
[1] "PIAL_TD"  "ACGL_TD"  "LAOC_TD"  "TABR2_TD" "CHNO_TD"  "POTR5_TD"

$rare
 [1] "LALY_TD"  "BEPA_TD"  "PREM_TD"  "ABPR_TD"  "PRVI_TD"  "ALRU2_TD"
 [7] "QUGA4_TD" "CONU4_TD" "ACMA3_TD" "JUOC_TD"  "FRLA_TD"  "2TB_TD"  
[13] "POBAT_TD" "MAFU_TD"  "ARME_TD"  "ABCO_TD"  "PISI_TD"  "PSMA_TD" 
[19] "ALRH2_TD" "JUNI_TD"  "BEUT_TD"  "BEOC2_TD" "PRPE2_TD" "JUHI_TD" 
[25] "CHLA_TD"  "PRAV_TD" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the quantiles for most prevelant species with zeroes</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(imp_data[,sp_prevalence$prevalent], 2, quantile, seq(0.86, 1, .01))</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the quantiles for common species with zeroes</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(imp_data[,sp_prevalence<span class="sc">$</span>common], <span class="dv">2</span>, quantile, <span class="fu">seq</span>(<span class="fl">0.95</span>, <span class="dv">1</span>, .<span class="dv">01</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        PIPO_TD    TSME_TD     ABGR_TD     THPL_TD     PIEN_TD     PICO_TD
95%     0.00000    0.00000    74.96528    74.96528     0.00000     0.00000
96%     0.00000    0.00000   149.93057    74.96528     0.00000     0.00000
97%     0.00000   74.96528   224.89585   149.93057     0.00000    74.96528
98%    74.96528   74.96528   374.82641   224.89585    74.96528   149.93057
99%   149.93057  224.89585   674.68754   449.79170   149.93057   449.79170
100% 9070.79918 4722.81279 13793.61197 14768.16064 24588.61264 18816.28590
       PIMO3_TD
95%     0.00000
96%     0.00000
97%     0.00000
98%     0.00000
99%    74.96528
100% 1874.13206</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the quantiles for uncommon species with zeroes</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(imp_data[,sp_prevalence<span class="sc">$</span>uncommon], <span class="dv">2</span>, quantile, <span class="fu">seq</span>(<span class="fl">0.9875</span>, <span class="dv">1</span>, .<span class="dv">0025</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         PIAL_TD     ACGL_TD     LAOC_TD   TABR2_TD    CHNO_TD   POTR5_TD
98.75%   0.00000     0.00000    74.96528    0.00000   74.96528    0.00000
99%      0.00000    74.96528    74.96528    0.00000   74.96528    0.00000
99.25%  74.96528    74.96528    74.96528   74.96528  149.93057   74.96528
99.5%   74.96528   149.93057   149.93057   74.96528  292.36460  149.93057
99.75% 149.93057   449.79170   449.79170  224.89585  449.79170  299.86113
100%   974.54867 24063.85567 10345.20898 2248.95847 3148.54186 2773.71545</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the quantiles for rare species with zeroes</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(imp_data[,sp_prevalence<span class="sc">$</span>rare], <span class="dv">2</span>, quantile, <span class="fu">seq</span>(<span class="fl">0.9925</span>, <span class="dv">1</span>, .<span class="dv">0025</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          LALY_TD  BEPA_TD    PREM_TD    ABPR_TD   PRVI_TD   ALRU2_TD
99.25%    0.00000     0.00    0.00000    0.00000    0.0000    0.00000
99.5%     0.00000     0.00   74.96528   74.96528    0.0000    0.00000
99.75%   74.96528     0.00  224.89585  149.93057  149.9306   74.96528
100%   2548.81960 10944.93 3523.36827 2623.78489 4347.9864 2248.95847
         QUGA4_TD CONU4_TD   ACMA3_TD  JUOC_TD  FRLA_TD   2TB_TD POBAT_TD
99.25%    0.00000   0.0000    0.00000   0.0000    0.000   0.0000     0.00
99.5%    67.46875   0.0000    0.00000   0.0000    0.000   0.0000     0.00
99.75%  149.93057   0.0000   74.96528   0.0000    0.000   0.0000     0.00
100%   2099.02791 449.7917 1049.51395 374.8264 8770.938 449.7917  1274.41
        MAFU_TD  ARME_TD ABCO_TD  PISI_TD  PSMA_TD ALRH2_TD  JUNI_TD  BEUT_TD
99.25%    0.000   0.0000    0.00   0.0000  0.00000   0.0000   0.0000  0.00000
99.5%     0.000   0.0000    0.00   0.0000  0.00000   0.0000   0.0000  0.00000
99.75%    0.000   0.0000    0.00   0.0000  0.00000   0.0000   0.0000  0.00000
100%   7196.667 224.8958 1274.41 674.6875 74.96528 449.7917 149.9306 74.96528
       BEOC2_TD PRPE2_TD  JUHI_TD  CHLA_TD  PRAV_TD
99.25%   0.0000   0.0000  0.00000   0.0000    0.000
99.5%    0.0000   0.0000  0.00000   0.0000    0.000
99.75%   0.0000   0.0000  0.00000   0.0000    0.000
100%   149.9306 224.8958 74.96528 374.8264 2248.958</code></pre>
</div>
</div>
</section>
<section id="set-2-rf-on-cds" class="level2">
<h2 class="anchored" data-anchor-id="set-2-rf-on-cds">Set 2, RF on CDS</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>CDS <span class="ot">&lt;-</span> imp_data_FPA[imp_data_FPA<span class="sc">$</span>fpa <span class="sc">==</span> <span class="st">"CDS"</span>, ]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>CDS <span class="ot">&lt;-</span> CDS <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">common =</span> <span class="fu">rowSums</span>(CDS[,sp_prevalence<span class="sc">$</span>common]),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">uncommon =</span> <span class="fu">rowSums</span>(CDS[,sp_prevalence<span class="sc">$</span>uncommon]),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rare_TD =</span> <span class="fu">rowSums</span>(CDS[,sp_prevalence<span class="sc">$</span>rare]), </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_TD =</span> <span class="fu">rowSums</span>((CDS[, <span class="dv">6</span><span class="sc">:</span><span class="dv">39</span>]))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>sp_prevalence<span class="sc">$</span>rare, <span class="sc">-</span>sp_prevalence<span class="sc">$</span>uncommon, <span class="sc">-</span>sp_prevalence<span class="sc">$</span>common) </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>CDS <span class="ot">&lt;-</span> CDS <span class="sc">|&gt;</span> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(fpa, <span class="at">.after =</span> FPAG)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the quantiles for most prevalent species with zeroes</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(CDS[,sp_prevalence<span class="sc">$</span>prevalent], <span class="dv">2</span>, quantile, <span class="fu">seq</span>(<span class="fl">0.99</span>, <span class="dv">1</span>, .<span class="dv">001</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         PSME_TD ABAM_TD   ABLA_TD   TSHE_TD
99%     974.5487       0   0.00000   0.00000
99.1%  1085.0475       0  74.96528   0.00000
99.2%  1199.4445       0  74.96528   0.00000
99.3%  1274.4098       0  74.96528   0.00000
99.4%  1349.3751       0  74.96528   0.00000
99.5%  1494.0581       0  74.96528   0.00000
99.6%  1574.2709       0 149.93057   0.00000
99.7%  1672.9252       0 149.93057   0.00000
99.8%  2024.0626       0 224.89585   0.00000
99.9%  2681.6581       0 357.73433  74.96528
100%  15142.9871       0 674.68754 299.86113</code></pre>
</div>
</div>
<p>I viewed the table and picked values based on the next highest after the max. I suppose I could also trim the highest values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I am replacing the highest value with the next highest value</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>CDS<span class="sc">$</span>PSME_TD[CDS<span class="sc">$</span>PSME_TD <span class="sc">&gt;</span> <span class="fl">3148.5</span>] <span class="ot">&lt;-</span> <span class="fl">3148.5</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing an All zero column and a nearly empty one. </span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>CDS <span class="ot">&lt;-</span> CDS <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(ABAM_TD, TSHE_TD))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>cds <span class="ot">&lt;-</span> CDS</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>refs <span class="ot">&lt;-</span> cds[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span><span class="fu">nrow</span>(cds)<span class="sc">/</span><span class="dv">4</span>),]</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># CDS</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># cds</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># data("MoscowMtStJoe")</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cds <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">remove_rownames</span>(x)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">column_to_rownames</span>(x, <span class="st">"STANDPLOT_CN"</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> cds <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">7</span><span class="sc">:</span><span class="fu">ncol</span>(cds))</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># y &lt;- y[refs]</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">remove_rownames</span>(y)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">column_to_rownames</span>(y, <span class="st">"STANDPLOT_CN"</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>mal <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">method =</span> <span class="st">"mahalanobis"</span>, <span class="at">k =</span> k)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>msn <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">method =</span> <span class="st">"msn"</span>, <span class="at">k =</span> k)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>gnn <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">method =</span> <span class="st">"gnn"</span>, <span class="at">k =</span> k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in yai(x = x, y = y, method = "gnn", k = k): 2944 rows have y-variable
row sums &lt;= 0 were converted to target observations for method gnn</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ica <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">method =</span> <span class="st">"ica"</span>, <span class="at">k =</span> k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: fastICA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>error_full <span class="ot">&lt;-</span> <span class="fu">errorStats</span>(mal, msn, gnn, ica)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in notablyDistant(x, p = 1 - pzero): when computing threshold, 441 zero
distances of 4615 references were set to 0.0000000002325966</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in notablyDistant(x, p = plg): when computing threshold, 441 zero
distances of 4615 references were set to 0.0000000002325966</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in notablyDistant(x, p = plg): when computing threshold, 441 zero
distances of 4615 references were set to 0.000000000130061</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in notablyDistant(x, p = plg): when computing threshold, 136 zero
distances of 1671 references were set to 0.00000000000000001387779</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in notablyDistant(x, p = plg): when computing threshold, 441 zero
distances of 4615 references were set to 0.000000000232622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>yrf <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">whatsMax</span>(y[ ,<span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(y)<span class="sc">-</span><span class="dv">1</span>)]), y[, <span class="fu">ncol</span>(y)])</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(yrf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Max_SP'</span>, <span class="st">'sp_max_TD'</span>, <span class="st">'total_TD'</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rf &lt;- yai(x = x, y = yrf, method = "randomForest", k = k)</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># save(rf, file = "rf.Rdata")</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"rf.Rdata"</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This won't run with rf in it? </span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># error_full &lt;- errorStats(mal, msn, gnn, rf)</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>Full_set <span class="ot">&lt;-</span> <span class="fu">impute</span>(rf, <span class="at">ancillaryData =</span> y)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>rmsd <span class="ot">&lt;-</span> <span class="fu">compare.yai</span>(mal, msn, gnn, Full_set, ica)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in compare.yai(mal, msn, gnn, Full_set, ica): not all scale factors are
the same.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmsd.yai</span>(Full_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              rmsd
PSME_TD  186.88683
ABLA_TD   25.13958
common   249.39947
uncommon 375.42857
rare_TD  110.26771
total_TD 426.26731</code></pre>
</div>
</div>
<section id="plots-rf-full-set" class="level3">
<h3 class="anchored" data-anchor-id="plots-rf-full-set">Plots, RF, Full set</h3>
<p>Dots below the one to one line indicate lower rmsd for the named imputation on the horizontal. RF does the best.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmsd, <span class="at">main =</span> <span class="st">"Full Set"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">3.2</span>,<span class="dv">1</span>))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rf, <span class="at">vars =</span> <span class="fu">yvars</span>(rf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">3.2</span>,<span class="dv">1</span>))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(msn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>rmsd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         mal.rmsdS msn.rmsdS gnn.rmsdS Full_set.rmsdS ica.rmsdS
PSME_TD  0.9742293 1.0028254 1.0430676      0.8709108 0.9783871
ABLA_TD  1.2163312 1.3051459 1.4111898      1.1119614 1.2163312
common   0.9446253 1.0126262 0.8401424      0.7409197 0.9465916
uncommon 1.4020282 1.3936819 1.4072269      1.0101107 1.4020564
rare_TD  1.3471906 1.2835394 1.3637743      1.1853372 1.3623549
total_TD 0.5857362 0.8211703 0.4994699      0.6540893 0.5857362</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>find_best <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">names</span>(df)[<span class="fu">apply</span>(df, <span class="dv">1</span>, which.min)],</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">value =</span> <span class="fu">apply</span>(df, <span class="dv">1</span>, min))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">find_best</span>(rmsd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   name     value
PSME_TD  Full_set.rmsdS 0.8709108
ABLA_TD  Full_set.rmsdS 1.1119614
common   Full_set.rmsdS 0.7409197
uncommon Full_set.rmsdS 1.0101107
rare_TD  Full_set.rmsdS 1.1853372
total_TD      gnn.rmsdS 0.4994699</code></pre>
</div>
</div>
</section>
</section>
<section id="rf-on-seedlings-only." class="level2">
<h2 class="anchored" data-anchor-id="rf-on-seedlings-only.">RF on seedlings only.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pulling from my new interim save point</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"./attempt_032524.db"</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co"># imp_data &lt;- dbGetQuery(con, "select * from imp_data")</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>zimp_data <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from regen_only_imp_data"</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from fvs_plotinit_plot"</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>plants_ref <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from plants_ref"</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(con)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Grabbing the topography variables</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>pred_topo <span class="ot">&lt;-</span> plots <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  STANDPLOT_CN, ELEVFT, SLOPE, ASPECT</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the Kralicek variables</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>pred_Kral <span class="ot">&lt;-</span> zimp_data <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  STANDPLOT_CN, CC, BA, SDI, FPAG</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the predictors from the response.</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> zimp_data <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">c</span>(CC, BA, SDI, FPAG)</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a><span class="co"># join the Kralicek and topo variables. </span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">left_join</span>(pred_Kral, pred_topo, <span class="fu">join_by</span>(STANDPLOT_CN))<span class="sc">|&gt;</span> </span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(FPAG, <span class="at">.after =</span> STANDPLOT_CN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sp-prev" class="level3">
<h3 class="anchored" data-anchor-id="sp-prev">Sp prev</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">apply</span>(zimp_data, <span class="dv">2</span>, max) </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> z[<span class="dv">6</span><span class="sc">:</span><span class="fu">length</span>(z)]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">names</span>(z)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> z</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(y) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(y)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(y) <span class="ot">&lt;-</span> x</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a sorted list of the maximum trees per acre per species on one plot</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co"># y |&gt; sort(decreasing = T)</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> zimp_data</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>imp_p <span class="ot">&lt;-</span> imp <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>imp_r <span class="ot">&lt;-</span> imp <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">6</span><span class="sc">:</span><span class="fu">ncol</span>(imp))</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>imp_r <span class="ot">&lt;-</span> imp_r <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_TD =</span> <span class="fu">rowSums</span>(imp_r[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(imp_r)])</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">left_join</span>(imp_p, imp_r, <span class="at">by =</span> <span class="st">"STANDPLOT_CN"</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="co"># This is why the species stuff below is the same as before. </span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>imp_z <span class="ot">&lt;-</span> imp[imp<span class="sc">$</span>total_TD <span class="sc">&gt;</span> <span class="dv">0</span>,]</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(imp_z[,6:ncol(imp_z)])</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(imp_z[,<span class="dv">6</span><span class="sc">:</span><span class="fu">ncol</span>(imp_z)], <span class="dv">2</span>, quantile, <span class="fu">seq</span>(<span class="fl">0.72</span>, <span class="fl">0.90</span>, .<span class="dv">04</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     ABGR_TD PIPO_TD   PSME_TD PIAL_TD   ABLA_TD TSME_TD LALY_TD   ABAM_TD
72%  0.00000       0   0.00000       0   0.00000       0       0   0.00000
76%  0.00000       0   0.00000       0   0.00000       0       0  74.96528
80%  0.00000       0  74.96528       0   0.00000       0       0  74.96528
84%  0.00000       0  74.96528       0  74.96528       0       0 224.89585
88% 74.96528       0 149.93057       0 149.93057       0       0 374.82641
    THPL_TD PIEN_TD   TSHE_TD ACGL_TD PICO_TD LAOC_TD TABR2_TD CHNO_TD BEPA_TD
72%       0       0   0.00000       0       0       0        0       0       0
76%       0       0   0.00000       0       0       0        0       0       0
80%       0       0   0.00000       0       0       0        0       0       0
84%       0       0  74.96528       0       0       0        0       0       0
88%       0       0 149.93057       0       0       0        0       0       0
    PREM_TD ABPR_TD PIMO3_TD PRVI_TD POTR5_TD ALRU2_TD QUGA4_TD CONU4_TD
72%       0       0        0       0        0        0        0        0
76%       0       0        0       0        0        0        0        0
80%       0       0        0       0        0        0        0        0
84%       0       0        0       0        0        0        0        0
88%       0       0        0       0        0        0        0        0
    ACMA3_TD JUOC_TD FRLA_TD 2TB_TD POBAT_TD MAFU_TD ARME_TD ABCO_TD PISI_TD
72%        0       0       0      0        0       0       0       0       0
76%        0       0       0      0        0       0       0       0       0
80%        0       0       0      0        0       0       0       0       0
84%        0       0       0      0        0       0       0       0       0
88%        0       0       0      0        0       0       0       0       0
    PSMA_TD ALRH2_TD JUNI_TD BEUT_TD BEOC2_TD PRPE2_TD JUHI_TD CHLA_TD PRAV_TD
72%       0        0       0       0        0        0       0       0       0
76%       0        0       0       0        0        0       0       0       0
80%       0        0       0       0        0        0       0       0       0
84%       0        0       0       0        0        0       0       0       0
88%       0        0       0       0        0        0       0       0       0
     total_TD
72%  599.7223
76%  749.6528
80%  899.5834
84% 1124.4792
88% 1349.3751</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>prevalent_sp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'PSME_TD'</span>, <span class="st">'ABAM_TD'</span>, <span class="st">'ABLA_TD'</span>, <span class="st">'TSHE_TD'</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">names</span>(imp_z)[<span class="sc">!</span><span class="fu">names</span>(imp_z) <span class="sc">%in%</span> prevalent_sp]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>imp_z2 <span class="ot">&lt;-</span> imp_z[,keep]</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(imp_z2[,6:ncol(imp_z2)], 2, quantile, seq(0.90, 0.9875, .025))</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>common_sp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'PIPO_TD'</span> , <span class="st">'TSME_TD'</span>, <span class="st">'ABGR_TD'</span>, <span class="st">'THPL_TD'</span>, <span class="st">'PIEN_TD'</span>, <span class="st">'PICO_TD'</span>, <span class="st">'PIMO3_TD'</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">names</span>(imp_z2)[<span class="sc">!</span><span class="fu">names</span>(imp_z2) <span class="sc">%in%</span> common_sp]</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>imp_z3 <span class="ot">&lt;-</span> imp_z2[,keep]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(imp_z3[,6:ncol(imp_z3)], 2, quantile, seq(0.975, .99, .005))</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>uncommon_sp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'PIAL_TD'</span>, <span class="st">'ACGL_TD'</span>, <span class="st">'LAOC_TD'</span>, <span class="st">'TABR2_TD'</span>, <span class="st">'CHNO_TD'</span>, </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'POTR5_TD'</span>)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">names</span>(imp_z3)[<span class="sc">!</span><span class="fu">names</span>(imp_z3) <span class="sc">%in%</span> uncommon_sp]</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>imp_z4 <span class="ot">&lt;-</span> imp_z3[,keep]</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(imp_z4[,6:ncol(imp_z4)], 2, quantile, seq(0.99, 1, .005))</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>rare_sp <span class="ot">&lt;-</span> <span class="fu">names</span>(imp_z4[,<span class="dv">6</span><span class="sc">:</span>(<span class="fu">ncol</span>(imp_z4)<span class="sc">-</span><span class="dv">1</span>)])</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>sp_prevalence <span class="ot">&lt;-</span>  <span class="fu">list</span>(<span class="at">prevalent =</span> prevalent_sp, </span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">common =</span> common_sp, </span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>     <span class="at">uncommon =</span> uncommon_sp, </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>     <span class="at">rare =</span> rare_sp)</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a><span class="co"># save(sp_prevalence, file = "sp_prevalence.Rdata")</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a><span class="co"># getwd()</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sp_prevalence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$prevalent
[1] "PSME_TD" "ABAM_TD" "ABLA_TD" "TSHE_TD"

$common
[1] "PIPO_TD"  "TSME_TD"  "ABGR_TD"  "THPL_TD"  "PIEN_TD"  "PICO_TD"  "PIMO3_TD"

$uncommon
[1] "PIAL_TD"  "ACGL_TD"  "LAOC_TD"  "TABR2_TD" "CHNO_TD"  "POTR5_TD"

$rare
 [1] "LALY_TD"  "BEPA_TD"  "PREM_TD"  "ABPR_TD"  "PRVI_TD"  "ALRU2_TD"
 [7] "QUGA4_TD" "CONU4_TD" "ACMA3_TD" "JUOC_TD"  "FRLA_TD"  "2TB_TD"  
[13] "POBAT_TD" "MAFU_TD"  "ARME_TD"  "ABCO_TD"  "PISI_TD"  "PSMA_TD" 
[19] "ALRH2_TD" "JUNI_TD"  "BEUT_TD"  "BEOC2_TD" "PRPE2_TD" "JUHI_TD" 
[25] "CHLA_TD"  "PRAV_TD" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the quantiles for most prevelant species with zeroes</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(imp_data[,sp_prevalence$prevalent], 2, quantile, seq(0.86, 1, .01))</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the quantiles for common species with zeroes</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(zimp_data[,sp_prevalence<span class="sc">$</span>common], <span class="dv">2</span>, quantile, <span class="fu">seq</span>(<span class="fl">0.95</span>, <span class="dv">1</span>, .<span class="dv">01</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        PIPO_TD    TSME_TD    ABGR_TD    THPL_TD     PIEN_TD     PICO_TD
95%    74.96528   74.96528   299.8611   149.9306    74.96528    74.96528
96%    74.96528   74.96528   374.8264   224.8958    74.96528   149.93057
97%    74.96528  149.93057   449.7917   299.8611    74.96528   224.89585
98%   149.93057  224.89585   674.6875   449.7917   149.93057   374.82641
99%   299.86113  449.79170  1124.4792   824.6181   299.86113   899.58339
100% 9070.79918 4722.81279 13793.6120 14768.1606 24588.61264 18816.28590
       PIMO3_TD
95%     0.00000
96%     0.00000
97%    74.96528
98%    74.96528
99%   149.93057
100% 1874.13206</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the quantiles for uncommon species with zeroes</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(zimp_data[,sp_prevalence<span class="sc">$</span>uncommon], <span class="dv">2</span>, quantile, <span class="fu">seq</span>(<span class="fl">0.9875</span>, <span class="dv">1</span>, .<span class="dv">0025</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         PIAL_TD    ACGL_TD     LAOC_TD   TABR2_TD   CHNO_TD   POTR5_TD
98.75%  74.96528   149.9306    74.96528   74.96528  149.9306   74.96528
99%     74.96528   149.9306   149.93057   74.96528  224.8958  149.93057
99.25%  74.96528   224.8958   224.89585  149.93057  299.8611  149.93057
99.5%  149.93057   449.7917   449.79170  224.89585  449.7917  299.86113
99.75% 224.89585   749.6528   899.58339  299.86113  749.6528  449.79170
100%   974.54867 24063.8557 10345.20898 2248.95847 3148.5419 2773.71545</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the quantiles for rare species with zeroes</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(zimp_data[,sp_prevalence<span class="sc">$</span>rare], <span class="dv">2</span>, quantile, <span class="fu">seq</span>(<span class="fl">0.9925</span>, <span class="dv">1</span>, .<span class="dv">0025</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          LALY_TD     BEPA_TD    PREM_TD    ABPR_TD   PRVI_TD   ALRU2_TD
99.25%    0.00000     0.00000   74.96528   74.96528    0.0000   74.96528
99.5%    74.96528     0.00000  224.89585  109.44931  149.9306   74.96528
99.75%  299.86113    74.96528  374.82641  299.86113  599.7223  167.17258
100%   2548.81960 10944.93124 3523.36827 2623.78489 4347.9864 2248.95847
         QUGA4_TD CONU4_TD   ACMA3_TD  JUOC_TD  FRLA_TD   2TB_TD   POBAT_TD
99.25%   74.96528   0.0000   74.96528   0.0000    0.000   0.0000    0.00000
99.5%   149.93057   0.0000   74.96528   0.0000    0.000   0.0000    0.00000
99.75%  374.82641   0.0000  149.93057   0.0000    0.000   0.0000   74.96528
100%   2099.02791 449.7917 1049.51395 374.8264 8770.938 449.7917 1274.40980
        MAFU_TD  ARME_TD ABCO_TD  PISI_TD  PSMA_TD ALRH2_TD  JUNI_TD  BEUT_TD
99.25%    0.000   0.0000    0.00   0.0000  0.00000   0.0000   0.0000  0.00000
99.5%     0.000   0.0000    0.00   0.0000  0.00000   0.0000   0.0000  0.00000
99.75%    0.000   0.0000    0.00   0.0000  0.00000   0.0000   0.0000  0.00000
100%   7196.667 224.8958 1274.41 674.6875 74.96528 449.7917 149.9306 74.96528
       BEOC2_TD PRPE2_TD  JUHI_TD  CHLA_TD  PRAV_TD
99.25%   0.0000   0.0000  0.00000   0.0000    0.000
99.5%    0.0000   0.0000  0.00000   0.0000    0.000
99.75%   0.0000   0.0000  0.00000   0.0000    0.000
100%   149.9306 224.8958 74.96528 374.8264 2248.958</code></pre>
</div>
</div>
</section>
<section id="cds" class="level3">
<h3 class="anchored" data-anchor-id="cds">CDS</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>imp_data_FPA <span class="ot">&lt;-</span> zimp_data <span class="sc">|&gt;</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fpa =</span> <span class="fu">str_sub</span>(FPAG, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">unique</span>(imp_data_FPA<span class="sc">$</span>fpa)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>CDS <span class="ot">&lt;-</span> imp_data_FPA[imp_data_FPA<span class="sc">$</span>fpa <span class="sc">==</span> <span class="st">"CDS"</span>, ]</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>CDS <span class="ot">&lt;-</span> CDS <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">common =</span> <span class="fu">rowSums</span>(CDS[,sp_prevalence<span class="sc">$</span>common]),</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">uncommon =</span> <span class="fu">rowSums</span>(CDS[,sp_prevalence<span class="sc">$</span>uncommon]),</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">rare_TD =</span> <span class="fu">rowSums</span>(CDS[,sp_prevalence<span class="sc">$</span>rare]), </span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_TD =</span> <span class="fu">rowSums</span>((CDS[, <span class="dv">6</span><span class="sc">:</span><span class="dv">39</span>]))</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>sp_prevalence<span class="sc">$</span>rare, <span class="sc">-</span>sp_prevalence<span class="sc">$</span>uncommon, <span class="sc">-</span>sp_prevalence<span class="sc">$</span>common) </span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>CDS <span class="ot">&lt;-</span> CDS <span class="sc">|&gt;</span> </span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(fpa, <span class="at">.after =</span> FPAG)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a><span class="co"># I am replacing the highest value with the next highest value</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>CDS<span class="sc">$</span>PSME_TD[CDS<span class="sc">$</span>PSME_TD <span class="sc">&gt;</span> <span class="fl">3148.5</span>] <span class="ot">&lt;-</span> <span class="fl">3148.5</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing an All zero column and a nearly empty one. </span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>CDS <span class="ot">&lt;-</span> CDS <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(ABAM_TD, TSHE_TD))</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>cds <span class="ot">&lt;-</span> CDS</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>refs <span class="ot">&lt;-</span> cds[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span><span class="fu">nrow</span>(cds)<span class="sc">/</span><span class="dv">4</span>),]</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a><span class="co"># CDS</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a><span class="co"># cds</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a><span class="co"># data("MoscowMtStJoe")</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cds <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">remove_rownames</span>(x)</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">column_to_rownames</span>(x, <span class="st">"STANDPLOT_CN"</span>)</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> cds <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">7</span><span class="sc">:</span><span class="fu">ncol</span>(cds))</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a><span class="co"># y &lt;- y[refs]</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">remove_rownames</span>(y)</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">column_to_rownames</span>(y, <span class="st">"STANDPLOT_CN"</span>)</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>zmal <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">method =</span> <span class="st">"mahalanobis"</span>, <span class="at">k =</span> k)</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>zmsn <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">method =</span> <span class="st">"msn"</span>, <span class="at">k =</span> k)</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>zgnn <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">method =</span> <span class="st">"gnn"</span>, <span class="at">k =</span> k)</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>zica <span class="ot">&lt;-</span> <span class="fu">yai</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">method =</span> <span class="st">"ica"</span>, <span class="at">k =</span> k)</span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>zerror_full <span class="ot">&lt;-</span> <span class="fu">errorStats</span>(zmal, zmsn, zgnn, zica)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in notablyDistant(x, p = 1 - pzero): when computing threshold, 144 zero
distances of 1671 references were set to 0.0000000003454502</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in notablyDistant(x, p = plg): when computing threshold, 144 zero
distances of 1671 references were set to 0.0000000003454502</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in notablyDistant(x, p = plg): when computing threshold, 144 zero
distances of 1671 references were set to 0.0000000002290794</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in notablyDistant(x, p = plg): when computing threshold, 136 zero
distances of 1671 references were set to 0.00000000000000005551115</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in notablyDistant(x, p = plg): when computing threshold, 144 zero
distances of 1671 references were set to 0.0000000003455539</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>zyrf <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">whatsMax</span>(y[ ,<span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(y)<span class="sc">-</span><span class="dv">1</span>)]), y[, <span class="fu">ncol</span>(y)])</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(zyrf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Max_SP'</span>, <span class="st">'sp_max_TD'</span>, <span class="st">'total_TD'</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># zrf &lt;- yai(x = x, y = zyrf, method = "randomForest", k = k)</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># save(zrf, file = "zrf.Rdata")</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"zrf.Rdata"</span>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This won't run with rf in it? </span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># error_full &lt;- errorStats(mal, msn, gnn, rf)</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>zFull_set <span class="ot">&lt;-</span> <span class="fu">impute</span>(zrf, <span class="at">ancillaryData =</span> y)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>zrmsd <span class="ot">&lt;-</span> <span class="fu">compare.yai</span>(zmal, zmsn, zgnn, zFull_set, zica)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rmsd.yai</span>(zFull_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              rmsd
PSME_TD  312.83162
ABLA_TD   44.27986
common   405.36313
uncommon 625.12598
rare_TD  183.63585
total_TD 709.81751</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>find_best <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">names</span>(df)[<span class="fu">apply</span>(df, <span class="dv">1</span>, which.min)],</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">value =</span> <span class="fu">apply</span>(df, <span class="dv">1</span>, min))</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">find_best</span>(zrmsd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    name     value
PSME_TD  zFull_set.rmsdS 0.9559565
ABLA_TD  zFull_set.rmsdS 1.1841441
common   zFull_set.rmsdS 0.7420633
uncommon zFull_set.rmsdS 1.0143569
rare_TD  zFull_set.rmsdS 1.2025893
total_TD      zgnn.rmsdS 0.4994699</code></pre>
</div>
</div>
</section>
<section id="plots" class="level3">
<h3 class="anchored" data-anchor-id="plots">Plots</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zrmsd, <span class="at">main =</span> <span class="st">"Full Set"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">3.2</span>,<span class="dv">1</span>))</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zrf, <span class="at">vars =</span> <span class="fu">yvars</span>(zrf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">3.2</span>,<span class="dv">1</span>))</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zmsn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2_Imputation_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>rmsd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (object, vars = NULL, scale = FALSE, ...) 
{
    if (missing(object)) 
        stop("object required.")
    if (class(object)[1] == "yai") 
        object = impute.yai(object, vars = vars, observed = TRUE, 
            ...)
    if (is.null(object)) 
        stop("no imputations found using this object")
    nuke = unlist(lapply(object, function(x) all(is.na(x))))
    nuke = nuke[nuke]
    if (length(nuke) &gt; 0) 
        object = object[, -match(names(nuke), names(object)), 
            drop = FALSE]
    object = na.omit(object)
    if (is.null(vars)) 
        vars = names(object)
    vi = paste(unique(strsplit(vars, ".o", fixed = TRUE)))
    vi = intersect(vi, names(object))
    notFound = setdiff(vars, names(object))
    if (length(notFound) &gt; 0) 
        warning("variables not found or had missing values: ", 
            paste(notFound, collapse = ", "))
    if (length(vi) == 0) 
        stop("nothing to compute")
    vo = paste(vi, "o", sep = ".")
    notFound = setdiff(vo, names(object))
    if (length(notFound) &gt; 0) 
        warning("variables not found or had missing values: ", 
            paste(notFound, collapse = ", "))
    vo = intersect(vo, names(object))
    both = intersect(paste(unique(strsplit(vo, ".o", fixed = TRUE))), 
        vi)
    if (length(both) == 0) 
        stop("nothing to compute")
    vo = paste(both, "o", sep = ".")
    rmsd = data.frame(rep(NA, length(vo)), row.names = both)
    names(rmsd) = if (scale || length(scale) &gt; 1) 
        "rmsdS"
    else "rmsd"
    usedScale = list()
    for (i in 1:length(both)) {
        if (!is.factor(object[, both[i]])) {
            rmsd[i, 1] = sqrt(mean(((object[, both[i]] - object[, 
                vo[i]])^2)))
            if (scale || length(scale) &gt; 1) {
                div = NULL
                if (length(scale) &gt; 1) 
                  div = scale[[both[i]]]
                if (is.null(div) || is.na(div)) 
                  div = attr(object, "scale")[both[i], "scale"]
                if (is.null(div) || is.na(div)) 
                  div = sd(object[, vo[i]])
                usedScale[[both[i]]] = div
                rmsd[i, 1] = if (!is.na(div) &amp;&amp; div &gt; 0.01) 
                  rmsd[i, 1]/div
                else NA
            }
        }
    }
    if (length(usedScale) &gt; 0) 
        attr(rmsd, "scale") = unlist(usedScale)
    rmsd
}
&lt;bytecode: 0x0000022725167ae8&gt;
&lt;environment: namespace:yaImpute&gt;</code></pre>
</div>
</div>
<section id="end" class="level4">
<h4 class="anchored" data-anchor-id="end">end</h4>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>